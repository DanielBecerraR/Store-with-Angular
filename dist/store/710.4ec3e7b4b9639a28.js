"use strict";(self.webpackChunkStore=self.webpackChunkStore||[]).push([[710],{4710:(j,m,o)=>{o.r(m),o.d(m,{CheckoutModule:()=>B});var u=o(6895),d=o(3060),p=o(8505),M=o(3900),y=o(4986),Z=o(7272),h=o(5698),O=o(4482),A=o(5403),T=o(5032),x=o(9718),b=o(5577);function C(n,r){return r?e=>(0,Z.z)(r.pipe((0,h.q)(1),function S(){return(0,O.e)((n,r)=>{n.subscribe((0,A.x)(r,T.Z))})}()),e.pipe(C(n))):(0,b.z)((e,a)=>n(e,a).pipe((0,h.q)(1),(0,x.h)(e)))}var P=o(5963),t=o(4650),k=o(529);let U=(()=>{class n{constructor(e){this.http=e,this.apiUrl="http://localhost:3000"}getStores(){return this.http.get(`${this.apiUrl}/stores`)}saveOrder(e){return this.http.post(`${this.apiUrl}/orders`,e)}saveDetailsOrder(e){return this.http.post(`${this.apiUrl}/detailsOrders`,e)}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(k.eN))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var f=o(9340),F=o(4496),l=o(4006),J=o(4859),g=o(7676),v=o(1948),_=o(3238),N=o(4144),I=o(9774);function Q(n,r){if(1&n&&(t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.ALo(7,"currency"),t.qZA(),t.TgZ(8,"td"),t._uU(9),t.ALo(10,"currency"),t.qZA()()),2&n){const e=r.$implicit;t.xp6(2),t.Oqu(e.name),t.xp6(2),t.Oqu(e.quantity),t.xp6(2),t.Oqu(t.lcZ(7,4,e.price)),t.xp6(3),t.Oqu(t.lcZ(10,6,e.quantity*e.price))}}let Y=(()=>{class n{constructor(e){this.shoppingCartService=e,this.total$=this.shoppingCartService.totalAction$,this.cart$=this.shoppingCartService.cartAction$}ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(f.F))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-details"]],decls:23,vars:8,consts:[[1,"container__table"],[1,"table"],[4,"ngFor","ngForOf"],[1,"container__total"],[1,"total"]],template:function(e,a){1&e&&(t.TgZ(0,"div",0)(1,"table",1)(2,"thead")(3,"tr")(4,"th"),t._uU(5,"Item"),t.qZA(),t.TgZ(6,"th"),t._uU(7,"Quantity"),t.qZA(),t.TgZ(8,"th"),t._uU(9,"Price unit"),t.qZA(),t.TgZ(10,"th"),t._uU(11,"Sub total"),t.qZA()()(),t.TgZ(12,"tbody"),t.YNc(13,Q,11,8,"tr",2),t.ALo(14,"async"),t.qZA()(),t.TgZ(15,"div",3)(16,"p",4)(17,"strong"),t._uU(18,"Total: "),t.TgZ(19,"span"),t._uU(20),t.ALo(21,"currency"),t.ALo(22,"async"),t.qZA()()()()()),2&e&&(t.xp6(13),t.Q6J("ngForOf",t.lcZ(14,2,a.cart$)),t.xp6(7),t.Oqu(t.lcZ(21,4,t.lcZ(22,6,a.total$))))},dependencies:[u.sg,u.Ov,u.H9],styles:[".container__table[_ngcontent-%COMP%]{width:90%;margin:0 4%}table[_ngcontent-%COMP%]{font-size:1.2rem}table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#3f51b5;color:#fff;padding:1rem;text-align:left}table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:#e2dddd;padding:1rem}table[_ngcontent-%COMP%]   .container__total[_ngcontent-%COMP%]{margin-top:1rem}table[_ngcontent-%COMP%]   .container__total[_ngcontent-%COMP%]   .total[_ngcontent-%COMP%]{color:#000;font-size:1.5 rem}"]}),n})();function $(n,r){1&n&&(t.TgZ(0,"mat-error"),t._uU(1," Name is required "),t.qZA())}function E(n,r){if(1&n){const e=t.EpF();t.ynx(0),t.TgZ(1,"mat-form-field",3)(2,"input",13,14),t.NdJ("ngModelChange",function(i){t.CHM(e);const c=t.oxw();return t.KtG(c.model.shippingAddress=i)}),t.qZA()(),t.TgZ(4,"mat-form-field",3)(5,"input",15,16),t.NdJ("ngModelChange",function(i){t.CHM(e);const c=t.oxw();return t.KtG(c.model.city=i)}),t.qZA()(),t.BQk()}if(2&n){const e=t.oxw();t.xp6(2),t.Q6J("ngModel",e.model.shippingAddress),t.xp6(3),t.Q6J("ngModel",e.model.city)}}function z(n,r){if(1&n&&(t.TgZ(0,"mat-option",21),t._uU(1),t.qZA()),2&n){const e=r.$implicit;t.Q6J("value",e),t.xp6(1),t.AsE(" ",e.name," - ",e.openingHours," ")}}function L(n,r){if(1&n){const e=t.EpF();t.TgZ(0,"mat-form-field",3)(1,"mat-label",17),t._uU(2,"Select me"),t.qZA(),t.TgZ(3,"mat-select",18,19),t.NdJ("ngModelChange",function(i){t.CHM(e);const c=t.oxw();return t.KtG(c.model.store=i)}),t.YNc(5,z,2,3,"mat-option",20),t.qZA()()}if(2&n){const e=t.oxw();t.xp6(3),t.Q6J("ngModel",e.model.store),t.xp6(2),t.Q6J("ngForOf",e.stores)}}const q=[{path:"",component:(()=>{class n{constructor(e,a,i,c){this.dataSvc=e,this.shoppingCartSvc=a,this.router=i,this.productService=c,this.model={name:"Daniel",store:"",shippingAddress:"",city:""},this.isDelivery=!0,this.stores=[],this.cart=[],this.checkifCartIsEmpty()}ngOnInit(){this.getStore(),this.getDataCart(),this.prepareDetails()}onPickupOrDelivery(e){this.isDelivery=e}onSubmit({value:e}){console.log("Guardar",e);const a={...e,date:this.getCurrentDay(),isDelivery:this.isDelivery};this.dataSvc.saveOrder(a).pipe((0,p.b)(i=>console.log("Order =>",i)),(0,M.w)(({id:i})=>{const c=this.prepareDetails();return this.dataSvc.saveDetailsOrder({details:c,orderId:i})}),(0,p.b)(()=>this.router.navigate(["/checkout/thank-you-page"])),function D(n,r=y.z){const e=(0,P.H)(n,r);return C(()=>e)}(1e3),(0,p.b)(()=>this.shoppingCartSvc.resetCart())).subscribe()}getStore(){this.dataSvc.getStores().pipe((0,p.b)(e=>this.stores=e)).subscribe()}prepareDetails(){const e=[];return this.cart.forEach(a=>{const{id:i,name:c,quantity:s}=a;this.productService.updateStock(i,s).pipe((0,p.b)(()=>e.push({productId:i,productName:c,quantity:s}))).subscribe()}),e}getDataCart(){this.shoppingCartSvc.cartAction$.pipe((0,p.b)(e=>this.cart=e)).subscribe()}getCurrentDay(){return(new Date).toLocaleDateString()}checkifCartIsEmpty(){this.shoppingCartSvc.cartAction$.pipe((0,p.b)(e=>{Array.isArray(e)&&!e.length&&this.router.navigate(["/products"])})).subscribe()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(U),t.Y36(f.F),t.Y36(d.F0),t.Y36(F.M))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-checkout"]],decls:21,vars:5,consts:[[1,"container"],[1,"form","item"],["checkoutForm","ngForm"],[1,"form__element"],["matInput","","placeholder","Name","required","","name","name",3,"ngModel","ngModelChange"],["name","ngModel"],[4,"ngIf"],["value","pickup",3,"change"],["value","delivery","checked","",3,"change"],[4,"ngIf","ngIfElse"],["showStores",""],[1,"container__button"],["mat-raised-button","","color","primary","type","submit",3,"disabled","click"],["matInput","","placeholder","Shipping Address","name","shippingAddress",3,"ngModel","ngModelChange"],["shippingAddress","ngModel"],["matInput","","placeholder","City","name","city",3,"ngModel","ngModelChange"],["city","ngModel"],["text-color","black"],["name","store",3,"ngModel","ngModelChange"],["store","ngModel"],["class","StyleText",3,"value",4,"ngFor","ngForOf"],[1,"StyleText",3,"value"]],template:function(e,a){if(1&e){const i=t.EpF();t.TgZ(0,"div",0)(1,"form",1,2)(3,"mat-form-field",3)(4,"input",4,5),t.NdJ("ngModelChange",function(s){return a.model.name=s}),t.qZA(),t.YNc(6,$,2,0,"mat-error",6),t.qZA(),t.TgZ(7,"mat-radio-group",3)(8,"p"),t._uU(9,"Choose an option:"),t.qZA(),t.TgZ(10,"mat-radio-button",7),t.NdJ("change",function(){return a.onPickupOrDelivery(!1)}),t._uU(11,"Pickup"),t.qZA(),t.TgZ(12,"mat-radio-button",8),t.NdJ("change",function(){return a.onPickupOrDelivery(!0)}),t._uU(13,"Delivery"),t.qZA()(),t.YNc(14,E,7,2,"ng-container",9),t.YNc(15,L,6,2,"ng-template",null,10,t.W1O),t.qZA()(),t._UZ(17,"app-details"),t.TgZ(18,"div",11)(19,"button",12),t.NdJ("click",function(){t.CHM(i);const s=t.MAs(2);return t.KtG(a.onSubmit(s))}),t._uU(20," Checkout "),t.qZA()()}if(2&e){const i=t.MAs(2),c=t.MAs(5),s=t.MAs(16);t.xp6(4),t.Q6J("ngModel",a.model.name),t.xp6(2),t.Q6J("ngIf",!c.valid||c.pristine),t.xp6(8),t.Q6J("ngIf",a.isDelivery)("ngIfElse",s),t.xp6(5),t.Q6J("disabled",!i.form.valid)}},dependencies:[u.sg,u.O5,l._Y,l.Fj,l.JJ,l.JL,l.Q7,l.On,l.F,J.lW,g.TO,g.KE,g.hX,v.VQ,v.U0,_.ey,N.Nt,I.gD,Y],styles:[".StyleText[_ngcontent-%COMP%]{color:#000}.container[_ngcontent-%COMP%]{display:flex;align-items:center;padding:1rem 5rem}.container[_ngcontent-%COMP%]   .item[_ngcontent-%COMP%]{flex:1 1 auto}.container[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]{width:100%}.container[_ngcontent-%COMP%]   .form__element[_ngcontent-%COMP%]{padding:5px 0 25px 2px;width:100%;margin-bottom:.5rem}.container__button[_ngcontent-%COMP%]{margin:0 auto;display:block;width:40%;margin-top:4rem}.container__button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}"]}),n})()},{path:"thank-you-page",loadChildren:()=>o.e(391).then(o.bind(o,9391)).then(n=>n.ThankYouPageModule)}];let H=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[d.Bz.forChild(q),d.Bz]}),n})();var G=o(2403);let B=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[u.ez,H,l.u5,G.q]}),n})()}}]);